<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë°”ë¥¸ì»´í¼ë‹ˆ ì±„ìš©ê´€ë¦¬ì‹œìŠ¤í…œ (Barun ATS)</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%232563EB'/><text x='16' y='22' font-size='18' font-weight='bold' fill='white' text-anchor='middle' font-family='Arial'>B</text></svg>">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,sans-serif;background:#F8F9FB;color:#1E293B;overflow-x:hidden}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:3px}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-8px)}40%,80%{transform:translateX(8px)}}
@keyframes slideIn{from{opacity:0;transform:scale(.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.fade-up{animation:fadeUp .5s ease-out}.slide-in{animation:slideIn .3s ease-out}.shake{animation:shake .4s ease}
input:focus,textarea:focus,select:focus{outline:none;border-color:#2563EB!important;box-shadow:0 0 0 3px rgba(37,99,235,.12)}
button{font-family:inherit}
.login-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0F172A 0%,#1E3A5F 50%,#0F172A 100%)}
.login-card{width:440px;background:#FFF;border-radius:20px;padding:48px 40px;box-shadow:0 25px 60px rgba(0,0,0,.3);animation:fadeUp .6s ease-out}
.login-logo{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#2563EB,#7C3AED);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px}
.login-input{width:100%;padding:12px 14px;border:1.5px solid #E2E8F0;border-radius:10px;font-size:14px;background:#F8FAFC;transition:all .2s;font-family:inherit}
.login-btn{width:100%;padding:13px;background:#2563EB;color:#FFF;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s;margin-top:20px}
.login-btn:hover{background:#1D4ED8;transform:translateY(-1px)}
.test-account{cursor:pointer;padding:5px 8px;border-radius:6px;background:#FFF;border:1px solid #E2E8F0;transition:all .15s;font-size:11px}
.test-account:hover{border-color:#2563EB;background:#EFF6FF}
.app-layout{display:flex;min-height:100vh}
.sidebar{width:240px;background:#0F172A;color:#FFF;display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100}
.sidebar-brand{padding:24px 20px 20px;border-bottom:1px solid rgba(255,255,255,.08)}
.sidebar-nav{flex:1;padding:16px 12px}
.nav-btn{width:100%;display:flex;align-items:center;gap:12px;padding:10px 14px;border:none;border-radius:10px;font-size:14px;cursor:pointer;margin-bottom:4px;transition:all .15s;text-align:left}
.nav-btn.active{background:#334155;color:#FFF;font-weight:600}.nav-btn:not(.active){background:transparent;color:#94A3B8;font-weight:500}
.nav-btn:not(.active):hover{background:#1E293B}
.sidebar-footer{padding:16px;border-top:1px solid rgba(255,255,255,.08)}
.logout-btn{width:100%;display:flex;align-items:center;justify-content:center;gap:8px;padding:8px;border:1px solid rgba(255,255,255,.1);border-radius:8px;background:transparent;color:#94A3B8;font-size:13px;cursor:pointer;transition:all .15s}
.logout-btn:hover{background:#1E293B;color:#FFF}
.main-content{flex:1;margin-left:240px;padding:28px 32px}
.stat-card{padding:20px 22px;background:#FFF;border-radius:14px;border:1px solid #E2E8F0;transition:all .2s}
.stat-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.06)}
.card{background:#FFF;border-radius:14px;border:1px solid #E2E8F0}
.kanban-col{min-width:220px;flex:1 0 220px;background:#F8FAFC;border-radius:12px;padding:12px;border:1px solid #E2E8F0}
.kanban-card{background:#FFF;border-radius:10px;padding:12px 14px;border:1px solid #E2E8F0;cursor:grab;transition:all .15s;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.kanban-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}.kanban-card:active{cursor:grabbing}
.stage-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600;white-space:nowrap}
.data-table{width:100%;border-collapse:collapse;font-size:14px}
.data-table th{padding:12px 16px;text-align:left;font-weight:600;color:#64748B;font-size:13px;border-bottom:1px solid #E2E8F0;background:#F8FAFC}
.data-table td{padding:12px 16px;border-bottom:1px solid #F1F5F9}
.data-table tbody tr{transition:background .1s}.data-table tbody tr:hover{background:#F8FAFC}
.modal-overlay{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center}
.modal-backdrop{position:absolute;inset:0;background:rgba(15,23,42,.5);backdrop-filter:blur(4px)}
.modal-content{position:relative;background:#FFF;border-radius:16px;box-shadow:0 25px 50px rgba(0,0,0,.2);animation:slideIn .3s ease-out}
.form-input{width:100%;padding:10px 12px;border:1.5px solid #E2E8F0;border-radius:8px;font-size:14px;font-family:inherit;transition:all .2s}
.form-select{width:100%;padding:10px 12px;border:1.5px solid #E2E8F0;border-radius:8px;font-size:14px;font-family:inherit;background:#FFF;cursor:pointer}
.form-label{display:block;font-size:13px;font-weight:600;color:#64748B;margin-bottom:5px}
.btn-primary{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;border:none;border-radius:10px;background:#2563EB;color:#FFF;font-size:14px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-primary:hover{background:#1D4ED8}
.btn-secondary{padding:10px 20px;border:1.5px solid #E2E8F0;border-radius:10px;background:#FFF;color:#64748B;font-size:14px;font-weight:600;cursor:pointer}
.btn-danger{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border:none;border-radius:8px;background:#FEE2E2;color:#DC2626;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-danger:hover{background:#FECACA}
.btn-stage{padding:6px 14px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s}
.search-wrap{position:relative}.search-wrap input{padding:8px 12px 8px 34px;border:1.5px solid #E2E8F0;border-radius:10px;font-size:13px;width:220px;font-family:inherit}
.search-wrap svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#94A3B8;pointer-events:none}
.star-btn{background:none;border:none;cursor:pointer;padding:2px;transition:transform .15s}.star-btn:hover{transform:scale(1.25)}
.privacy-badge{display:inline-flex;align-items:center;gap:4px;font-size:12px;color:#F59E0B;font-weight:600}
.role-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600}
.hover-lift{transition:all .2s}.hover-lift:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,.08)}
.toast{position:fixed;bottom:24px;right:24px;padding:12px 20px;border-radius:10px;color:#FFF;font-size:14px;font-weight:500;z-index:2000;animation:slideIn .3s ease-out}
@media(max-width:900px){.sidebar{width:60px}.sidebar .brand-text,.sidebar .nav-label,.sidebar .user-info,.sidebar .logout-label{display:none}.main-content{margin-left:60px}}
</style>
</head>
<body>
<div id="app"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect} = React;

const STAGES=["ì„œë¥˜ì ‘ìˆ˜","ì„œë¥˜ê²€í† ","1ì°¨ ë©´ì ‘","2ì°¨ ë©´ì ‘","ìµœì¢…í•©ê²©","ë¶ˆí•©ê²©"];
const SC={"ì„œë¥˜ì ‘ìˆ˜":{bg:"#E5E7EB",text:"#374151",dot:"#9CA3AF"},"ì„œë¥˜ê²€í† ":{bg:"#DBEAFE",text:"#1E40AF",dot:"#3B82F6"},"1ì°¨ ë©´ì ‘":{bg:"#FEF3C7",text:"#92400E",dot:"#F59E0B"},"2ì°¨ ë©´ì ‘":{bg:"#FFEDD5",text:"#9A3412",dot:"#F97316"},"ìµœì¢…í•©ê²©":{bg:"#D1FAE5",text:"#065F46",dot:"#10B981"},"ë¶ˆí•©ê²©":{bg:"#FEE2E2",text:"#991B1B",dot:"#EF4444"}};
const DEPTS=["ì˜ì—…íŒ€","CSíŒ€","êµ¬ë§¤íŒ€"];
const CHS=["ì¡ì½”ë¦¬ì•„","ì‚¬ëŒì¸","ì•Œë°”ëª¬","ì›í‹°ë“œ","ê¸°íƒ€"];
const ROLES=["ìµœê³ ê´€ë¦¬ì","ë¶€ì„œê´€ë¦¬ì","ì¼ë°˜ì‚¬ìš©ì"];
const ROLE_COLORS={"ìµœê³ ê´€ë¦¬ì":{bg:"#FEF3C7",text:"#92400E",icon:"ğŸ‘‘"},"ë¶€ì„œê´€ë¦¬ì":{bg:"#DBEAFE",text:"#1E40AF",icon:"ğŸ”‘"},"ì¼ë°˜ì‚¬ìš©ì":{bg:"#E5E7EB",text:"#374151",icon:"ğŸ‘¤"}};
const TUSERS=[{id:"admin",name:"ê¹€ì¸ì‚¬",r:"ìµœê³ ê´€ë¦¬ì"},{id:"sales_mgr",name:"ë°•ì˜ì—…",r:"ì˜ì—…íŒ€ ê´€ë¦¬ì"},{id:"cs_mgr",name:"ì´ì„œë¹„ìŠ¤",r:"CSíŒ€ ê´€ë¦¬ì"},{id:"purchase_mgr",name:"ìµœêµ¬ë§¤",r:"êµ¬ë§¤íŒ€ ê´€ë¦¬ì"},{id:"sales1",name:"ê°•ì˜ì—…",r:"ì˜ì—…íŒ€ ì‚¬ìš©ì"},{id:"cs1",name:"ìœ¤ì„œë¹„ìŠ¤",r:"CSíŒ€ ì‚¬ìš©ì"}];

const api={
  async post(u,b){const r=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});return r.json()},
  async get(u){const r=await fetch(u);return r.json()},
  async put(u,b){const r=await fetch(u,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});return r.json()},
  async del(u){const r=await fetch(u,{method:"DELETE"});return r.json()},
};

// Icons
const Ic={
  Users:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>,
  Board:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>,
  Briefcase:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/></svg>,
  Shield:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
  Logout:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg>,
  Plus:()=><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2.5"><path d="M12 5v14M5 12h14"/></svg>,
  X:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M18 6L6 18M6 6l12 12"/></svg>,
  Lock:()=><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>,
  Search:()=><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>,
  Chart:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>,
  Settings:()=><svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>,
  Edit:()=><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
  Trash:()=><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>,
  Star:({f})=>f?<svg width="16" height="16" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" strokeWidth="1"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>:<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#D1D5DB" strokeWidth="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
};
const Stars=({score})=><span style={{display:"flex",gap:1}}>{[1,2,3,4,5].map(n=><Ic.Star key={n} f={n<=score}/>)}</span>;
function StageBadge({stage}){const c=SC[stage];return <span className="stage-badge" style={{background:c.bg,color:c.text}}><span style={{width:7,height:7,borderRadius:"50%",background:c.dot}}/>{stage}</span>}
function RoleBadge({role}){const c=ROLE_COLORS[role]||ROLE_COLORS["ì¼ë°˜ì‚¬ìš©ì"];return <span className="role-badge" style={{background:c.bg,color:c.text}}>{c.icon} {role}</span>}
function Toast({msg,type,onClose}){useEffect(()=>{const t=setTimeout(onClose,3000);return()=>clearTimeout(t)},[]);return <div className="toast" style={{background:type==="success"?"#059669":type==="error"?"#DC2626":"#2563EB"}}>{msg}</div>}

// Query builder
function q(user){
  if(user.roleLevel==="ìµœê³ ê´€ë¦¬ì") return `roleLevel=ìµœê³ ê´€ë¦¬ì`;
  return `roleLevel=${user.roleLevel}&department=${user.department}`;
}

// â”€â”€â”€ Login â”€â”€â”€
function Login({onLogin}){
  const [id,setId]=useState("");const [pw,setPw]=useState("");const [err,setErr]=useState("");const [shk,setShk]=useState(false);const [loading,setLoading]=useState(false);
  const go=async()=>{setLoading(true);try{const r=await api.post("/api/login",{id,password:pw});if(r.success){onLogin(r.user)}else{setErr(r.error||"ë¡œê·¸ì¸ ì‹¤íŒ¨");setShk(true);setTimeout(()=>setShk(false),500)}}catch(e){setErr("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}setLoading(false)};
  return(
    <div className="login-wrap">
      <div className={`login-card ${shk?"shake":""}`}>
        <div style={{textAlign:"center",marginBottom:36}}>
          <div className="login-logo"><span style={{color:"#FFF",fontWeight:800,fontSize:22}}>B</span></div>
          <h1 style={{fontSize:22,fontWeight:700,marginBottom:6}}>ë°”ë¥¸ì»´í¼ë‹ˆ ì±„ìš©ê´€ë¦¬</h1>
          <p style={{fontSize:14,color:"#64748B"}}>Barun ATSì— ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        </div>
        <div style={{marginBottom:18}}><label className="form-label">ì•„ì´ë””</label><input className="login-input" value={id} onChange={e=>{setId(e.target.value);setErr("")}} onKeyDown={e=>e.key==="Enter"&&go()} placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"/></div>
        <div style={{marginBottom:10}}><label className="form-label">ë¹„ë°€ë²ˆí˜¸</label><input className="login-input" type="password" value={pw} onChange={e=>{setPw(e.target.value);setErr("")}} onKeyDown={e=>e.key==="Enter"&&go()} placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"/></div>
        {err&&<p style={{color:"#DC2626",fontSize:13,marginTop:8,fontWeight:500}}>{err}</p>}
        <button className="login-btn" onClick={go} disabled={loading}>{loading?"ë¡œê·¸ì¸ ì¤‘...":"ë¡œê·¸ì¸"}</button>
        <div style={{marginTop:28,padding:"16px 18px",background:"#F8FAFC",borderRadius:10,border:"1px solid #E2E8F0"}}>
          <p style={{fontSize:12,fontWeight:600,color:"#64748B",marginBottom:10}}>í…ŒìŠ¤íŠ¸ ê³„ì • ì•ˆë‚´</p>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:5}}>
            {TUSERS.map(u=><div key={u.id} className="test-account" onClick={()=>{setId(u.id);setPw("1234");setErr("")}}><b>{u.name}</b><br/><span style={{color:"#94A3B8"}}>{u.r}</span></div>)}
          </div>
          <p style={{fontSize:11,color:"#94A3B8",marginTop:8}}>ë¹„ë°€ë²ˆí˜¸: 1234 (ëª¨ë“  ê³„ì • ë™ì¼)</p>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ Dashboard â”€â”€â”€
function Dashboard({user}){
  const [data,setData]=useState(null);
  useEffect(()=>{api.get(`/api/dashboard?${q(user)}`).then(setData)},[]);
  if(!data) return <div style={{padding:40,textAlign:"center",color:"#94A3B8"}}>ë¡œë”© ì¤‘...</div>;
  const mx=Math.max(...Object.values(data.stageCounts),1);
  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";
  const stats=[{l:"ì „ì²´ ì§€ì›ì",v:data.total,c:"#2563EB"},{l:"ì§„í–‰ ì¤‘",v:data.active,c:"#F59E0B"},{l:"ìµœì¢…í•©ê²©",v:data.hired,c:"#059669"},{l:"ì§„í–‰ ì¤‘ ê³µê³ ",v:data.openPostings,c:"#7C3AED"}];
  return(
    <div className="fade-up">
      <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:16,marginBottom:28}}>
        {stats.map((s,i)=><div key={i} className="stat-card"><div style={{fontSize:13,color:"#64748B",fontWeight:500,marginBottom:6}}>{s.l}</div><div style={{fontSize:32,fontWeight:800,color:s.c}}>{s.v}</div></div>)}
      </div>
      <div style={{display:"grid",gridTemplateColumns:"2fr 1fr",gap:20}}>
        <div className="card" style={{padding:24}}>
          <h3 style={{fontSize:16,fontWeight:700,marginBottom:20}}>ì±„ìš© ë‹¨ê³„ë³„ í˜„í™©</h3>
          {STAGES.map(s=>{const c=SC[s];const n=data.stageCounts[s]||0;return(
            <div key={s} style={{display:"flex",alignItems:"center",gap:12,marginBottom:12}}>
              <span style={{width:72,fontSize:13,fontWeight:600,color:c.text,textAlign:"right"}}>{s}</span>
              <div style={{flex:1,height:28,background:"#F1F5F9",borderRadius:6,overflow:"hidden"}}><div style={{height:"100%",width:`${(n/mx)*100}%`,background:c.dot,borderRadius:6,transition:"width .6s",minWidth:n>0?4:0}}/></div>
              <span style={{width:28,fontSize:14,fontWeight:700,textAlign:"right"}}>{n}</span>
            </div>
          )})}
        </div>
        <div className="card" style={{padding:24}}>
          <h3 style={{fontSize:16,fontWeight:700,marginBottom:16}}>ìµœê·¼ ì§€ì›ì</h3>
          {(data.recentApplicants||[]).map(a=>(
            <div key={a.id} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #F1F5F9"}}>
              <div><div style={{fontSize:14,fontWeight:600}}>{a.name}</div><div style={{fontSize:12,color:"#64748B"}}>{a.department} Â· {a.position}</div></div>
              <StageBadge stage={a.stage}/>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ Kanban â”€â”€â”€
function Kanban({user,search,onSelect}){
  const [apps,setApps]=useState([]);
  const load=()=>api.get(`/api/applicants?${q(user)}`).then(setApps);
  useEffect(()=>{load()},[]);
  const filtered=search?apps.filter(a=>a.name.includes(search)||a.position.includes(search)):apps;
  const active=STAGES.filter(s=>s!=="ë¶ˆí•©ê²©");const rejected=filtered.filter(a=>a.stage==="ë¶ˆí•©ê²©");
  const canDrag=user.roleLevel!=="ì¼ë°˜ì‚¬ìš©ì";
  const drop=async(stage,e)=>{if(!canDrag)return;e.preventDefault();const id=parseInt(e.dataTransfer.getData("aid"));const a=apps.find(x=>x.id===id);if(a&&a.stage!==stage){await api.put(`/api/applicants/${id}?${q(user)}`,{stage});load()}};
  return(
    <div className="fade-up">
      <div style={{display:"flex",gap:14,overflowX:"auto",paddingBottom:16,minHeight:400}}>
        {active.map(stage=>{const items=filtered.filter(a=>a.stage===stage);const c=SC[stage];return(
          <div key={stage} className="kanban-col" onDragOver={e=>e.preventDefault()} onDrop={e=>drop(stage,e)}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,padding:"0 4px"}}>
              <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{width:10,height:10,borderRadius:"50%",background:c.dot}}/><span style={{fontSize:14,fontWeight:700}}>{stage}</span></div>
              <span style={{fontSize:12,fontWeight:700,color:"#94A3B8",background:"#E2E8F0",borderRadius:10,padding:"2px 8px"}}>{items.length}</span>
            </div>
            <div style={{display:"flex",flexDirection:"column",gap:8,minHeight:60}}>
              {items.map(a=>(
                <div key={a.id} className="kanban-card" draggable={canDrag} onDragStart={e=>e.dataTransfer.setData("aid",a.id)} onClick={()=>onSelect(a)}>
                  <div style={{fontSize:14,fontWeight:600,marginBottom:4}}>{a.name}</div>
                  <div style={{fontSize:12,color:"#64748B",marginBottom:8}}>{a.position}</div>
                  <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                    <span style={{fontSize:11,color:"#94A3B8"}}>{a.appliedAt}</span>
                    {a.score>0&&<Stars score={a.score}/>}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )})}
      </div>
      {rejected.length>0&&(
        <div style={{marginTop:16,padding:16,background:"#FEF2F2",borderRadius:12,border:"1px solid #FECACA"}}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}><span style={{width:10,height:10,borderRadius:"50%",background:"#EF4444"}}/><span style={{fontSize:14,fontWeight:700,color:"#991B1B"}}>ë¶ˆí•©ê²©</span><span style={{fontSize:12,fontWeight:700,color:"#FCA5A5",background:"#FEE2E2",borderRadius:10,padding:"2px 8px"}}>{rejected.length}</span></div>
          <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>{rejected.map(a=><div key={a.id} onClick={()=>onSelect(a)} style={{background:"#FFF",borderRadius:8,padding:"8px 14px",border:"1px solid #FECACA",cursor:"pointer",fontSize:13}}><b style={{color:"#991B1B"}}>{a.name}</b> <span style={{color:"#FCA5A5"}}>{a.position}</span></div>)}</div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ Excel Upload Modal â”€â”€â”€
function ExcelUploadModal({user,onClose,onUploaded}){
  const [data,setData]=useState([]);const [headers,setHeaders]=useState([]);const [mapping,setMapping]=useState({});const [uploading,setUploading]=useState(false);const [step,setStep]=useState(1);
  const fields=[{k:"name",l:"ì´ë¦„ *"},{k:"department",l:"ë¶€ì„œ"},{k:"position",l:"ì§ë¬´"},{k:"channel",l:"ì§€ì›ê²½ë¡œ"},{k:"phone",l:"ì—°ë½ì²˜"},{k:"email",l:"ì´ë©”ì¼"},{k:"appliedAt",l:"ì§€ì›ì¼"}];

  const handleFile=async(e)=>{
    const file=e.target.files[0];if(!file)return;
    // CSV or TSV parsing
    const text=await file.text();
    const sep=file.name.endsWith('.tsv')?'\t':',';
    const lines=text.split('\n').filter(l=>l.trim());
    if(lines.length<2){alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");return}
    const hdrs=lines[0].split(sep).map(h=>h.trim().replace(/"/g,''));
    setHeaders(hdrs);
    const rows=lines.slice(1).map(line=>{
      const vals=line.split(sep).map(v=>v.trim().replace(/"/g,''));
      const obj={};hdrs.forEach((h,i)=>obj[h]=vals[i]||"");return obj;
    }).filter(r=>Object.values(r).some(v=>v));
    setData(rows);
    // Auto-mapping
    const autoMap={};
    fields.forEach(f=>{
      const match=hdrs.find(h=>h.includes(f.l.replace(' *',''))||h.toLowerCase().includes(f.k));
      if(match) autoMap[f.k]=match;
    });
    setMapping(autoMap);
    setStep(2);
  };

  const handleUpload=async()=>{
    if(!mapping.name){alert("'ì´ë¦„' ì—´ì„ ë°˜ë“œì‹œ ë§¤í•‘í•´ì£¼ì„¸ìš”.");return}
    setUploading(true);
    const apps=data.map(row=>{
      const obj={};
      fields.forEach(f=>{if(mapping[f.k])obj[f.k]=row[mapping[f.k]]||""});
      return obj;
    }).filter(a=>a.name);
    const r=await api.post(`/api/applicants/bulk?${q(user)}`,{applicants:apps});
    setUploading(false);
    if(r.success){onUploaded(r.count);onClose()}else{alert(r.error||"ì—…ë¡œë“œ ì‹¤íŒ¨")}
  };

  return(
    <div className="modal-overlay" onClick={onClose}><div className="modal-backdrop"/>
      <div className="modal-content slide-in" style={{width:680,maxHeight:"85vh",overflow:"auto",padding:28}} onClick={e=>e.stopPropagation()}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}>
          <h2 style={{fontSize:18,fontWeight:700}}>ì—‘ì…€/CSV ì¼ê´„ ë“±ë¡</h2>
          <button onClick={onClose} style={{background:"none",border:"none",cursor:"pointer",color:"#94A3B8"}}><Ic.X/></button>
        </div>

        {step===1&&(
          <div>
            <div style={{padding:32,border:"2px dashed #CBD5E1",borderRadius:12,textAlign:"center",background:"#F8FAFC",marginBottom:16}}>
              <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="#94A3B8" strokeWidth="1.5" style={{margin:"0 auto 12px"}}><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
              <p style={{fontSize:14,fontWeight:600,color:"#475569",marginBottom:8}}>CSV ë˜ëŠ” TSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
              <p style={{fontSize:12,color:"#94A3B8",marginBottom:16}}>ì±„ìš©ì‚¬ì´íŠ¸ì—ì„œ ë‹¤ìš´ë°›ì€ ì§€ì›ì ëª©ë¡ íŒŒì¼</p>
              <label style={{display:"inline-flex",alignItems:"center",gap:6,padding:"10px 24px",borderRadius:10,background:"#2563EB",color:"#FFF",fontSize:14,fontWeight:600,cursor:"pointer"}}>
                íŒŒì¼ ì„ íƒ
                <input type="file" hidden onChange={handleFile} accept=".csv,.tsv,.txt"/>
              </label>
            </div>
            <div style={{padding:16,background:"#FFFBEB",borderRadius:10,border:"1px solid #FEF3C7"}}>
              <p style={{fontSize:13,fontWeight:600,color:"#92400E",marginBottom:8}}>ğŸ“‹ íŒŒì¼ ì¤€ë¹„ ë°©ë²•</p>
              <p style={{fontSize:12,color:"#92400E",lineHeight:1.8}}>
                1. ì±„ìš©ì‚¬ì´íŠ¸(ì‚¬ëŒì¸/ì¡ì½”ë¦¬ì•„ ë“±)ì—ì„œ ì§€ì›ì ëª©ë¡ ë‹¤ìš´ë¡œë“œ<br/>
                2. ì—‘ì…€ì—ì„œ ì—´ê³  â†’ "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" â†’ CSV(ì‰¼í‘œ êµ¬ë¶„) ì„ íƒ<br/>
                3. ë˜ëŠ” ì§ì ‘ CSV íŒŒì¼ ì‘ì„± (ì²« í–‰: í—¤ë”, ì´í›„ í–‰: ë°ì´í„°)<br/><br/>
                ì˜ˆì‹œ: ì´ë¦„,ë¶€ì„œ,ì§ë¬´,ì—°ë½ì²˜,ì´ë©”ì¼<br/>
                í™ê¸¸ë™,ì˜ì—…íŒ€,ì˜ì—…ì‚¬ì›,010-1234-5678,hong@email.com
              </p>
            </div>
          </div>
        )}

        {step===2&&(
          <div>
            <p style={{fontSize:14,fontWeight:600,color:"#1E293B",marginBottom:12}}>ì—´ ë§¤í•‘ ({data.length}ëª…ì˜ ë°ì´í„°ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤)</p>
            <p style={{fontSize:12,color:"#64748B",marginBottom:16}}>CSV ì—´ì„ ì§€ì›ì í•„ë“œì— ì—°ê²°í•´ì£¼ì„¸ìš”.</p>
            <div style={{display:"grid",gap:10,marginBottom:20}}>
              {fields.map(f=>(
                <div key={f.k} style={{display:"flex",alignItems:"center",gap:12}}>
                  <span style={{width:80,fontSize:13,fontWeight:600,color:"#475569",textAlign:"right"}}>{f.l}</span>
                  <span style={{color:"#94A3B8"}}>â†</span>
                  <select className="form-select" style={{flex:1}} value={mapping[f.k]||""} onChange={e=>setMapping(p=>({...p,[f.k]:e.target.value}))}>
                    <option value="">-- ì„ íƒ ì•ˆ í•¨ --</option>
                    {headers.map(h=><option key={h} value={h}>{h}</option>)}
                  </select>
                </div>
              ))}
            </div>
            {data.length>0&&(
              <div style={{marginBottom:16}}>
                <p style={{fontSize:13,fontWeight:600,color:"#64748B",marginBottom:8}}>ë¯¸ë¦¬ë³´ê¸° (ìƒìœ„ 3ê±´)</p>
                <div style={{overflowX:"auto",border:"1px solid #E2E8F0",borderRadius:8}}>
                  <table style={{width:"100%",fontSize:12,borderCollapse:"collapse"}}>
                    <thead><tr style={{background:"#F8FAFC"}}>{headers.map(h=><th key={h} style={{padding:"8px 12px",textAlign:"left",fontWeight:600,color:"#64748B",borderBottom:"1px solid #E2E8F0",whiteSpace:"nowrap"}}>{h}</th>)}</tr></thead>
                    <tbody>{data.slice(0,3).map((r,i)=><tr key={i}>{headers.map(h=><td key={h} style={{padding:"8px 12px",borderBottom:"1px solid #F1F5F9",whiteSpace:"nowrap"}}>{r[h]}</td>)}</tr>)}</tbody>
                  </table>
                </div>
              </div>
            )}
            <div style={{display:"flex",justifyContent:"space-between"}}>
              <button className="btn-secondary" onClick={()=>{setStep(1);setData([]);setHeaders([]);setMapping({})}}>â† ë‹¤ì‹œ ì„ íƒ</button>
              <button className="btn-primary" onClick={handleUpload} disabled={uploading||!mapping.name} style={{opacity:mapping.name?1:.5}}>{uploading?`ë“±ë¡ ì¤‘ (${data.length}ëª…)...`:`${data.length}ëª… ì¼ê´„ ë“±ë¡`}</button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€â”€ Table with checkboxes â”€â”€â”€
function AppTable({user,search,onSelect,showToast}){
  const [apps,setApps]=useState([]);const [checked,setChecked]=useState(new Set());const [showExcel,setShowExcel]=useState(false);
  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";
  const load=()=>api.get(`/api/applicants?${q(user)}`).then(d=>{setApps(d);setChecked(new Set())});
  useEffect(()=>{load()},[]);
  const filtered=apps.filter(a=>!search||a.name.includes(search)||a.position.includes(search)||(a.department||"").includes(search));
  const allChecked=filtered.length>0&&filtered.every(a=>checked.has(a.id));
  const toggleAll=()=>{if(allChecked)setChecked(new Set());else setChecked(new Set(filtered.map(a=>a.id)))};
  const toggle=(id)=>{const s=new Set(checked);s.has(id)?s.delete(id):s.add(id);setChecked(s)};

  const bulkDelete=async()=>{
    const ids=[...checked];
    if(!confirm(`ì„ íƒí•œ ${ids.length}ëª…ì˜ ì§€ì›ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.`))return;
    const r=await api.post(`/api/applicants/bulk-delete?${q(user)}`,{ids});
    if(r.success){showToast(`${r.deleted}ëª…ì˜ ì§€ì›ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);load()}
  };

  return(
    <div className="fade-up">
      {/* Action bar */}
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
        <div style={{display:"flex",gap:8,alignItems:"center"}}>
          {checked.size>0&&isSA&&(
            <button className="btn-danger" onClick={bulkDelete} style={{padding:"8px 16px"}}>
              <Ic.Trash/> ì„ íƒ ì‚­ì œ ({checked.size}ëª…)
            </button>
          )}
          {checked.size>0&&<span style={{fontSize:13,color:"#64748B"}}>{checked.size}ëª… ì„ íƒë¨</span>}
        </div>
        <button onClick={()=>setShowExcel(true)} style={{display:"inline-flex",alignItems:"center",gap:6,padding:"8px 16px",border:"1px solid #059669",borderRadius:10,background:"#ECFDF5",color:"#059669",fontSize:13,fontWeight:600,cursor:"pointer"}}>
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M12 18v-6M9 15h6"/></svg>
          CSV ì¼ê´„ ë“±ë¡
        </button>
      </div>

      <div className="card" style={{overflow:"hidden"}}>
        <table className="data-table"><thead><tr>
          {isSA&&<th style={{width:40}}><input type="checkbox" checked={allChecked} onChange={toggleAll} style={{cursor:"pointer",width:16,height:16}}/></th>}
          {["ì§€ì›ì","ë¶€ì„œ","ì§ë¬´","ì±„ìš©ë‹¨ê³„",isSA&&"ì§€ì›ê²½ë¡œ",isSA&&"ì—°ë½ì²˜","ì§€ì›ì¼","í‰ê°€"].filter(Boolean).map((h,i)=><th key={i}>{h}</th>)}
        </tr></thead>
          <tbody>{filtered.map(a=>(
            <tr key={a.id} style={{background:checked.has(a.id)?"#EFF6FF":"transparent"}}>
              {isSA&&<td onClick={e=>e.stopPropagation()}><input type="checkbox" checked={checked.has(a.id)} onChange={()=>toggle(a.id)} style={{cursor:"pointer",width:16,height:16}}/></td>}
              <td style={{fontWeight:600,cursor:"pointer"}} onClick={()=>onSelect(a)}>{a.name}</td>
              <td style={{color:"#64748B",cursor:"pointer"}} onClick={()=>onSelect(a)}>{a.department}</td>
              <td style={{color:"#64748B",cursor:"pointer"}} onClick={()=>onSelect(a)}>{a.position}</td>
              <td style={{cursor:"pointer"}} onClick={()=>onSelect(a)}><StageBadge stage={a.stage}/></td>
              {isSA&&<td style={{color:"#64748B"}}>{a.channel}</td>}
              {isSA&&<td style={{color:"#64748B"}}>{a.phone}</td>}
              <td style={{color:"#64748B"}}>{a.appliedAt}</td>
              <td>{a.score>0?<Stars score={a.score}/>:<span style={{color:"#CBD5E1",fontSize:13}}>ë¯¸í‰ê°€</span>}</td>
            </tr>
          ))}</tbody>
        </table>
        {filtered.length===0&&<div style={{padding:48,textAlign:"center",color:"#94A3B8"}}>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>}
      </div>
      {showExcel&&<ExcelUploadModal user={user} onClose={()=>setShowExcel(false)} onUploaded={(n)=>{showToast(`${n}ëª…ì˜ ì§€ì›ìê°€ ì¼ê´„ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);load()}}/>}
    </div>
  );
}

// â”€â”€â”€ Postings â”€â”€â”€
function Postings({user,showToast}){
  const [posts,setPosts]=useState([]);
  const load=()=>api.get(`/api/postings?${q(user)}`).then(setPosts);
  useEffect(()=>{load()},[]);
  const canEdit=user.roleLevel!=="ì¼ë°˜ì‚¬ìš©ì";
  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";
  const statusC={"ì¤€ë¹„ì¤‘":"#94A3B8","ëª¨ì§‘ì¤‘":"#2563EB","ë§ˆê°":"#F59E0B","ì±„ìš©ì™„ë£Œ":"#059669"};
  const updateStatus=async(p,status)=>{await api.put(`/api/postings/${p.id}?${q(user)}`,{status});load()};
  const deletePosting=async(p)=>{if(!confirm(`'${p.title}' ê³µê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;await api.del(`/api/postings/${p.id}?${q(user)}`);showToast("ì±„ìš©ê³µê³ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");load()};
  return(
    <div className="fade-up" style={{display:"flex",flexDirection:"column",gap:12}}>
      {posts.map(p=>(
        <div key={p.id} className="card hover-lift" style={{padding:"20px 24px"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div>
              <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:6}}><h3 style={{fontSize:16,fontWeight:700,margin:0}}>{p.title}</h3><span style={{fontSize:12,fontWeight:700,padding:"3px 10px",borderRadius:20,background:`${statusC[p.status]}18`,color:statusC[p.status]}}>{p.status}</span></div>
              <div style={{display:"flex",gap:16,fontSize:13,color:"#64748B"}}><span>{p.department}</span><span>Â·</span><span>ëª¨ì§‘ {p.headcount}ëª…</span><span>Â·</span><span>{p.startDate} ~ {p.endDate}</span></div>
            </div>
            <div style={{display:"flex",gap:8,alignItems:"center"}}>
              {canEdit&&<select className="form-select" style={{width:"auto"}} value={p.status} onChange={e=>updateStatus(p,e.target.value)}>{["ì¤€ë¹„ì¤‘","ëª¨ì§‘ì¤‘","ë§ˆê°","ì±„ìš©ì™„ë£Œ"].map(s=><option key={s}>{s}</option>)}</select>}
              {(isSA||canEdit)&&<button className="btn-danger" onClick={()=>deletePosting(p)} title="ê³µê³  ì‚­ì œ"><Ic.Trash/></button>}
            </div>
          </div>
          <div style={{display:"flex",gap:6,marginTop:12}}>{p.channels.map(c=><span key={c} style={{fontSize:12,padding:"3px 10px",borderRadius:6,background:"#F1F5F9",color:"#475569",fontWeight:500}}>{c}</span>)}</div>
        </div>
      ))}
      {posts.length===0&&<div style={{padding:48,textAlign:"center",color:"#94A3B8"}}>ë“±ë¡ëœ ì±„ìš©ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>}
    </div>
  );
}

// â”€â”€â”€ Account Management (ìµœê³ ê´€ë¦¬ì ì „ìš©) â”€â”€â”€
function AccountMgmt({user,showToast}){
  const [users,setUsers]=useState([]);const [showAdd,setShowAdd]=useState(false);const [editUser,setEditUser]=useState(null);
  const load=()=>api.get(`/api/users?roleLevel=ìµœê³ ê´€ë¦¬ì`).then(setUsers);
  useEffect(()=>{load()},[]);

  const deleteUser=async(uid)=>{
    if(!confirm(`ì •ë§ '${uid}' ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
    const r=await api.del(`/api/users/${uid}?roleLevel=ìµœê³ ê´€ë¦¬ì`);
    if(r.success){showToast("ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");load()}else{showToast(r.error,"error")}
  };

  return(
    <div className="fade-up">
      <div className="card" style={{overflow:"hidden"}}>
        <div style={{padding:"20px 24px",borderBottom:"1px solid #E2E8F0",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div><h3 style={{fontSize:16,fontWeight:700,margin:0}}>ë“±ë¡ëœ ê³„ì • ({users.length}ëª…)</h3><p style={{fontSize:13,color:"#64748B",marginTop:4}}>ìµœê³ ê´€ë¦¬ìë§Œ ê³„ì •ì„ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div>
          <button className="btn-primary" onClick={()=>setShowAdd(true)}><Ic.Plus/> ìƒˆ ê³„ì • ë§Œë“¤ê¸°</button>
        </div>
        <table className="data-table">
          <thead><tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ê¶Œí•œ ë“±ê¸‰</th><th>ì†Œì† ë¶€ì„œ</th><th>ê´€ë¦¬</th></tr></thead>
          <tbody>
            {users.map(u=>(
              <tr key={u.id}>
                <td style={{fontWeight:600}}>{u.name}</td>
                <td style={{color:"#64748B"}}>{u.id}</td>
                <td><RoleBadge role={u.roleLevel}/></td>
                <td style={{color:"#64748B"}}>{u.roleLevel==="ìµœê³ ê´€ë¦¬ì"?"ì „ì²´ ë¶€ì„œ":(u.department||"-")}</td>
                <td>
                  <div style={{display:"flex",gap:6}}>
                    <button onClick={()=>setEditUser(u)} style={{display:"inline-flex",alignItems:"center",gap:4,padding:"6px 12px",border:"none",borderRadius:8,background:"#EFF6FF",color:"#2563EB",fontSize:13,fontWeight:600,cursor:"pointer"}}><Ic.Edit/> ìˆ˜ì •</button>
                    {u.id!=="admin"&&<button className="btn-danger" onClick={()=>deleteUser(u.id)}><Ic.Trash/> ì‚­ì œ</button>}
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* ê¶Œí•œ ì„¤ëª… */}
      <div style={{marginTop:20,display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:16}}>
        {ROLES.map(r=>{const c=ROLE_COLORS[r];return(
          <div key={r} className="card" style={{padding:"20px 24px"}}>
            <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:12}}><span style={{fontSize:24}}>{c.icon}</span><span style={{fontSize:16,fontWeight:700}}>{r}</span></div>
            <div style={{fontSize:13,color:"#64748B",lineHeight:1.8}}>
              {r==="ìµœê³ ê´€ë¦¬ì"&&<span>âœ… ëª¨ë“  ë¶€ì„œ ì§€ì›ì ì—´ëŒ<br/>âœ… ê°œì¸ì •ë³´(ì—°ë½ì²˜/ì´ë ¥ì„œ) ì—´ëŒ<br/>âœ… ì§€ì›ì ë“±ë¡/ì‚­ì œ<br/>âœ… ê³„ì • ìƒì„±/ìˆ˜ì •/ì‚­ì œ<br/>âœ… ì±„ìš©ê³µê³  ê´€ë¦¬</span>}
              {r==="ë¶€ì„œê´€ë¦¬ì"&&<span>âœ… í•´ë‹¹ ë¶€ì„œ ì§€ì›ì ì—´ëŒ<br/>ğŸ”’ ê°œì¸ì •ë³´ ë¹„ê³µê°œ<br/>âœ… ì§€ì›ì ë“±ë¡ ê°€ëŠ¥<br/>âœ… ì±„ìš© ë‹¨ê³„ ë³€ê²½<br/>âœ… ì±„ìš©ê³µê³  ìƒíƒœ ë³€ê²½<br/>âŒ ê³„ì • ê´€ë¦¬ ë¶ˆê°€</span>}
              {r==="ì¼ë°˜ì‚¬ìš©ì"&&<span>âœ… í•´ë‹¹ ë¶€ì„œ ì§€ì›ì ì—´ëŒ<br/>ğŸ”’ ê°œì¸ì •ë³´ ë¹„ê³µê°œ<br/>âŒ ì§€ì›ì ë“±ë¡ ë¶ˆê°€<br/>âœ… í‰ê°€(ì ìˆ˜/ì½”ë©˜íŠ¸)ë§Œ ê°€ëŠ¥<br/>âŒ ì±„ìš© ë‹¨ê³„ ë³€ê²½ ë¶ˆê°€<br/>âŒ ê³„ì • ê´€ë¦¬ ë¶ˆê°€</span>}
            </div>
          </div>
        )})}
      </div>

      {showAdd&&<AccountModal onClose={()=>setShowAdd(false)} onSaved={()=>{load();showToast("ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")}}/>}
      {editUser&&<AccountModal user={editUser} onClose={()=>setEditUser(null)} onSaved={()=>{load();showToast("ê³„ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")}}/>}
    </div>
  );
}

function AccountModal({user:editUser,onClose,onSaved}){
  const isEdit=!!editUser;
  const [f,sF]=useState(editUser?{id:editUser.id,name:editUser.name,password:"",roleLevel:editUser.roleLevel,department:editUser.department||""}:{id:"",name:"",password:"",roleLevel:"ì¼ë°˜ì‚¬ìš©ì",department:"ì˜ì—…íŒ€"});
  const [err,setErr]=useState("");const [saving,setSaving]=useState(false);
  const u=(k,v)=>sF(p=>({...p,[k]:v}));

  const save=async()=>{
    if(!f.name){setErr("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");return}
    if(!isEdit&&!f.id){setErr("ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");return}
    if(!isEdit&&!f.password){setErr("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");return}
    if(f.roleLevel!=="ìµœê³ ê´€ë¦¬ì"&&!f.department){setErr("ì†Œì† ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”.");return}
    setSaving(true);
    const body={name:f.name,roleLevel:f.roleLevel,department:f.roleLevel==="ìµœê³ ê´€ë¦¬ì"?null:f.department};
    if(f.password) body.password=f.password;
    let r;
    if(isEdit){r=await api.put(`/api/users/${editUser.id}?roleLevel=ìµœê³ ê´€ë¦¬ì`,body)}
    else{r=await api.post(`/api/users?roleLevel=ìµœê³ ê´€ë¦¬ì`,{...body,id:f.id,password:f.password})}
    setSaving(false);
    if(r.error){setErr(r.error);return}
    onSaved();onClose();
  };

  return(
    <div className="modal-overlay" onClick={onClose}><div className="modal-backdrop"/>
      <div className="modal-content slide-in" style={{width:480,padding:28}} onClick={e=>e.stopPropagation()}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24}}>
          <h2 style={{fontSize:18,fontWeight:700}}>{isEdit?"ê³„ì • ìˆ˜ì •":"ìƒˆ ê³„ì • ë§Œë“¤ê¸°"}</h2>
          <button onClick={onClose} style={{background:"none",border:"none",cursor:"pointer",color:"#94A3B8"}}><Ic.X/></button>
        </div>
        <div style={{display:"grid",gap:14}}>
          {!isEdit&&<div><label className="form-label">ì•„ì´ë”” *</label><input className="form-input" value={f.id} onChange={e=>u("id",e.target.value)} placeholder="ì˜ë¬¸/ìˆ«ì ì¡°í•©"/></div>}
          <div><label className="form-label">ì´ë¦„ *</label><input className="form-input" value={f.name} onChange={e=>u("name",e.target.value)} placeholder="ì‚¬ìš©ì ì´ë¦„"/></div>
          <div><label className="form-label">{isEdit?"ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥)":"ë¹„ë°€ë²ˆí˜¸ *"}</label><input className="form-input" type="password" value={f.password} onChange={e=>u("password",e.target.value)} placeholder={isEdit?"ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”":"ë¹„ë°€ë²ˆí˜¸"}/></div>
          <div><label className="form-label">ê¶Œí•œ ë“±ê¸‰ *</label>
            <div style={{display:"flex",gap:8}}>
              {ROLES.map(r=>{const c=ROLE_COLORS[r];return <button key={r} onClick={()=>u("roleLevel",r)} style={{flex:1,padding:"10px 8px",borderRadius:10,border:f.roleLevel===r?`2px solid ${c.text}`:"2px solid #E2E8F0",background:f.roleLevel===r?c.bg:"#FFF",color:f.roleLevel===r?c.text:"#64748B",fontSize:13,fontWeight:600,cursor:"pointer",textAlign:"center",transition:"all .15s"}}>{c.icon} {r}</button>})}
            </div>
          </div>
          {f.roleLevel!=="ìµœê³ ê´€ë¦¬ì"&&<div><label className="form-label">ì†Œì† ë¶€ì„œ *</label><select className="form-select" value={f.department} onChange={e=>u("department",e.target.value)}>{DEPTS.map(d=><option key={d}>{d}</option>)}</select></div>}
        </div>
        {err&&<p style={{color:"#DC2626",fontSize:13,marginTop:10,fontWeight:500}}>{err}</p>}
        <div style={{display:"flex",justifyContent:"flex-end",gap:10,marginTop:24}}>
          <button className="btn-secondary" onClick={onClose}>ì·¨ì†Œ</button>
          <button className="btn-primary" onClick={save} disabled={saving}>{saving?"ì €ì¥ ì¤‘...":(isEdit?"ìˆ˜ì •":"ìƒì„±")}</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ File Manager Component â”€â”€â”€
function FileManager({appId,user,isSA,canEdit}){
  const [files,setFiles]=useState([]);const [uploading,setUploading]=useState(false);const [showUrlForm,setShowUrlForm]=useState(false);const [urlName,setUrlName]=useState("");const [urlValue,setUrlValue]=useState("");
  const load=()=>api.get(`/api/files/${appId}?${q(user)}`).then(d=>{if(Array.isArray(d))setFiles(d)}).catch(()=>{});
  useEffect(()=>{load()},[appId]);

  const handleFileUpload=async(e)=>{
    const file=e.target.files[0];if(!file)return;
    setUploading(true);
    const fd=new FormData();fd.append("file",file);
    try{
      const r=await fetch("/api/upload",{method:"POST",body:fd}).then(r=>r.json());
      if(r.success){await api.post(`/api/files/${appId}?${q(user)}`,{name:r.originalName||file.name,url:r.url,type:"file"});load()}
    }catch(err){console.error(err)}
    setUploading(false);e.target.value="";
  };

  const handleUrlAdd=async()=>{
    if(!urlValue)return;
    await api.post(`/api/files/${appId}?${q(user)}`,{name:urlName||urlValue,url:urlValue,type:"url"});
    setUrlName("");setUrlValue("");setShowUrlForm(false);load();
  };

  const handleDelete=async(fileId)=>{
    if(!confirm("ì´ ì²¨ë¶€íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;
    await api.del(`/api/files/${appId}/${fileId}?${q(user)}`);load();
  };

  const fileIcon=(type)=>type==="url"?
    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#2563EB" strokeWidth="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>:
    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#059669" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>;

  if(!isSA&&!canEdit) return <div style={{padding:"14px 16px",background:"#F8FAFC",borderRadius:10,display:"flex",alignItems:"center",gap:8}}><Ic.Lock/><span style={{fontSize:13,color:"#94A3B8"}}>ì²¨ë¶€íŒŒì¼ì€ ìµœê³ ê´€ë¦¬ì/ë¶€ì„œê´€ë¦¬ìë§Œ ì—´ëŒ ê°€ëŠ¥</span></div>;

  return(
    <div>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}>
        <label className="form-label" style={{margin:0}}>ì²¨ë¶€íŒŒì¼ ({files.length})</label>
        {canEdit&&<div style={{display:"flex",gap:6}}>
          <label style={{display:"inline-flex",alignItems:"center",gap:4,padding:"5px 12px",borderRadius:8,background:"#D1FAE5",color:"#065F46",fontSize:12,fontWeight:600,cursor:"pointer"}}>
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
            {uploading?"ì—…ë¡œë“œ ì¤‘...":"íŒŒì¼ ì—…ë¡œë“œ"}
            <input type="file" hidden onChange={handleFileUpload} accept=".pdf,.doc,.docx,.hwp,.jpg,.jpeg,.png,.zip"/>
          </label>
          <button onClick={()=>setShowUrlForm(!showUrlForm)} style={{display:"inline-flex",alignItems:"center",gap:4,padding:"5px 12px",borderRadius:8,background:"#DBEAFE",color:"#1E40AF",fontSize:12,fontWeight:600,cursor:"pointer",border:"none"}}>
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
            URL ì¶”ê°€
          </button>
        </div>}
      </div>

      {showUrlForm&&(
        <div style={{padding:14,background:"#F8FAFC",borderRadius:10,marginBottom:10,display:"flex",gap:8,alignItems:"flex-end"}}>
          <div style={{flex:1}}><label style={{fontSize:11,color:"#64748B",fontWeight:600}}>íŒŒì¼ëª…</label><input className="form-input" value={urlName} onChange={e=>setUrlName(e.target.value)} placeholder="ì˜ˆ: í¬íŠ¸í´ë¦¬ì˜¤" style={{padding:"8px 10px",fontSize:13}}/></div>
          <div style={{flex:2}}><label style={{fontSize:11,color:"#64748B",fontWeight:600}}>URL</label><input className="form-input" value={urlValue} onChange={e=>setUrlValue(e.target.value)} placeholder="https://..." style={{padding:"8px 10px",fontSize:13}}/></div>
          <button onClick={handleUrlAdd} style={{padding:"8px 14px",border:"none",borderRadius:8,background:"#2563EB",color:"#FFF",fontSize:13,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>ì¶”ê°€</button>
        </div>
      )}

      {files.length>0?(
        <div style={{display:"flex",flexDirection:"column",gap:6}}>
          {files.map(f=>(
            <div key={f.id} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",background:"#F8FAFC",borderRadius:8,border:"1px solid #E2E8F0"}}>
              <div style={{display:"flex",alignItems:"center",gap:10,flex:1,minWidth:0}}>
                {fileIcon(f.type)}
                <a href={f.type==="url"?f.url:f.url} target="_blank" rel="noopener noreferrer" style={{fontSize:13,fontWeight:600,color:f.type==="url"?"#2563EB":"#059669",textDecoration:"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{f.name}</a>
                <span style={{fontSize:11,color:"#94A3B8",flexShrink:0}}>{f.addedAt}</span>
              </div>
              {canEdit&&<button onClick={()=>handleDelete(f.id)} style={{background:"none",border:"none",cursor:"pointer",color:"#94A3B8",padding:4,flexShrink:0}} title="ì‚­ì œ"><Ic.Trash/></button>}
            </div>
          ))}
        </div>
      ):(
        <div style={{padding:"20px 16px",background:"#F8FAFC",borderRadius:10,textAlign:"center",color:"#94A3B8",fontSize:13}}>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      )}
    </div>
  );
}

// â”€â”€â”€ Detail Modal â”€â”€â”€
function DetailModal({appData,user,onClose,onSaved}){
  const [sc,setSc]=useState(appData.score||0);const [cm,setCm]=useState(appData.comment||"");const [st,setSt]=useState(appData.stage);const [saving,setSaving]=useState(false);
  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";const canChangeStage=user.roleLevel!=="ì¼ë°˜ì‚¬ìš©ì";const canEdit=user.roleLevel!=="ì¼ë°˜ì‚¬ìš©ì";
  const locked=<span style={{display:"inline-flex",alignItems:"center",gap:4,color:"#94A3B8",fontSize:13}}><Ic.Lock/> ë¹„ê³µê°œ (ìµœê³ ê´€ë¦¬ì ì „ìš©)</span>;
  const save=async()=>{setSaving(true);const body={score:sc,comment:cm};if(canChangeStage)body.stage=st;await api.put(`/api/applicants/${appData.id}?${q(user)}`,body);setSaving(false);onSaved();onClose()};
  const Info=({l,v})=><div><span style={{display:"block",fontSize:12,color:"#94A3B8",fontWeight:500,marginBottom:3}}>{l}</span><span style={{fontSize:14,fontWeight:500}}>{v}</span></div>;
  return(
    <div className="modal-overlay" onClick={onClose}><div className="modal-backdrop"/>
      <div className="modal-content slide-in" style={{width:600,maxHeight:"90vh",overflow:"auto"}} onClick={e=>e.stopPropagation()}>
        <div style={{padding:"24px 28px 0"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div><h2 style={{fontSize:20,fontWeight:700,margin:0}}>{appData.name}</h2><p style={{fontSize:14,color:"#64748B",marginTop:4}}>{appData.department} Â· {appData.position}</p></div><button onClick={onClose} style={{background:"none",border:"none",cursor:"pointer",color:"#94A3B8"}}><Ic.X/></button></div></div>
        <div style={{padding:"20px 28px"}}>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14,marginBottom:20}}>
            <Info l="ì§€ì›ì¼" v={appData.appliedAt}/><Info l="ì§€ì› ê²½ë¡œ" v={isSA?(appData.channel||"-"):locked}/>
            <Info l="ì—°ë½ì²˜" v={isSA?(appData.phone||"-"):locked}/><Info l="ì´ë©”ì¼" v={isSA?(appData.email||"-"):locked}/>
          </div>

          {/* ì²¨ë¶€íŒŒì¼ ì˜ì—­ */}
          <div style={{marginBottom:20}}>
            <FileManager appId={appData.id} user={user} isSA={isSA} canEdit={canEdit}/>
          </div>

          {canChangeStage?(
            <div style={{marginBottom:18}}><label className="form-label" style={{marginBottom:8}}>ì±„ìš© ë‹¨ê³„</label>
              <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{STAGES.map(s=>{const c=SC[s];return <button key={s} className="btn-stage" onClick={()=>setSt(s)} style={{border:st===s?`2px solid ${c.dot}`:"2px solid #E2E8F0",background:st===s?c.bg:"#FFF",color:st===s?c.text:"#64748B"}}>{s}</button>})}</div>
            </div>
          ):(
            <div style={{marginBottom:18}}><label className="form-label" style={{marginBottom:8}}>ì±„ìš© ë‹¨ê³„</label><StageBadge stage={st}/><span style={{fontSize:12,color:"#94A3B8",marginLeft:8}}>(ë³€ê²½ ê¶Œí•œ ì—†ìŒ)</span></div>
          )}
          <div style={{marginBottom:18}}><label className="form-label" style={{marginBottom:8}}>í‰ê°€ ì ìˆ˜</label>
            <div style={{display:"flex",alignItems:"center",gap:4}}>{[1,2,3,4,5].map(n=><button key={n} className="star-btn" onClick={()=>setSc(n)}><Ic.Star f={n<=sc}/></button>)}<span style={{fontSize:13,color:"#64748B",marginLeft:8}}>{sc>0?`${sc}ì `:"ë¯¸í‰ê°€"}</span></div>
          </div>
          <div style={{marginBottom:20}}><label className="form-label" style={{marginBottom:8}}>í‰ê°€ ì½”ë©˜íŠ¸</label><textarea className="form-input" value={cm} onChange={e=>setCm(e.target.value)} rows={3} placeholder="ì§€ì›ìì— ëŒ€í•œ í‰ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style={{resize:"vertical"}}/></div>
        </div>
        <div style={{padding:"16px 28px 24px",display:"flex",justifyContent:"space-between",gap:10}}>
          {isSA&&<button className="btn-danger" onClick={async()=>{if(!confirm(`'${appData.name}' ì§€ì›ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.`))return;await api.del(`/api/applicants/${appData.id}?${q(user)}`);onSaved();onClose()}}><Ic.Trash/> ì§€ì›ì ì‚­ì œ</button>}
          {!isSA&&<div/>}
          <div style={{display:"flex",gap:10}}>
            <button className="btn-secondary" onClick={onClose}>ì·¨ì†Œ</button>
            <button className="btn-primary" onClick={save} disabled={saving}>{saving?"ì €ì¥ ì¤‘...":"ì €ì¥"}</button>
          </div>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ Add Applicant Modal â”€â”€â”€
function AddModal({user,onClose,onAdded}){
  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";
  const [f,sF]=useState({name:"",department:isSA?"ì˜ì—…íŒ€":user.department,position:"",channel:"ì¡ì½”ë¦¬ì•„",phone:"",email:""});const [saving,setSaving]=useState(false);
  const u=(k,v)=>sF(p=>({...p,[k]:v}));
  const save=async()=>{if(!f.name||!f.position)return;setSaving(true);await api.post(`/api/applicants?${q(user)}`,f);setSaving(false);onAdded();onClose()};
  return(
    <div className="modal-overlay" onClick={onClose}><div className="modal-backdrop"/>
      <div className="modal-content slide-in" style={{width:480,padding:28}} onClick={e=>e.stopPropagation()}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24}}><h2 style={{fontSize:18,fontWeight:700}}>ì‹ ê·œ ì§€ì›ì ë“±ë¡</h2><button onClick={onClose} style={{background:"none",border:"none",cursor:"pointer",color:"#94A3B8"}}><Ic.X/></button></div>
        <div style={{display:"grid",gap:14}}>
          <div><label className="form-label">ì§€ì›ìëª… *</label><input className="form-input" value={f.name} onChange={e=>u("name",e.target.value)} placeholder="ì„±ëª…"/></div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
            <div><label className="form-label">ì§€ì› ë¶€ì„œ</label>{isSA?<select className="form-select" value={f.department} onChange={e=>u("department",e.target.value)}>{DEPTS.map(d=><option key={d}>{d}</option>)}</select>:<input className="form-input" value={f.department} disabled style={{background:"#F1F5F9"}}/>}</div>
            <div><label className="form-label">ì§€ì› ì§ë¬´ *</label><input className="form-input" value={f.position} onChange={e=>u("position",e.target.value)} placeholder="ì§ë¬´ëª…"/></div>
          </div>
          <div><label className="form-label">ì§€ì› ê²½ë¡œ</label><select className="form-select" value={f.channel} onChange={e=>u("channel",e.target.value)}>{CHS.map(c=><option key={c}>{c}</option>)}</select></div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
            <div><label className="form-label">ì—°ë½ì²˜</label><input className="form-input" value={f.phone} onChange={e=>u("phone",e.target.value)} placeholder="010-0000-0000"/></div>
            <div><label className="form-label">ì´ë©”ì¼</label><input className="form-input" value={f.email} onChange={e=>u("email",e.target.value)} placeholder="email@example.com"/></div>
          </div>
        </div>
        <div style={{display:"flex",justifyContent:"flex-end",gap:10,marginTop:24}}>
          <button className="btn-secondary" onClick={onClose}>ì·¨ì†Œ</button>
          <button className="btn-primary" onClick={save} style={{opacity:f.name&&f.position?1:.5}} disabled={saving}>{saving?"ë“±ë¡ ì¤‘...":"ë“±ë¡"}</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ App â”€â”€â”€
function App(){
  const [user,setUser]=useState(null);const [page,setPage]=useState("dashboard");const [sel,setSel]=useState(null);const [addM,setAddM]=useState(false);const [search,setSearch]=useState("");const [toast,setToast]=useState(null);const [rk,setRk]=useState(0);
  const refresh=()=>setRk(k=>k+1);
  const showToast=(msg,type="success")=>setToast({msg,type});
  if(!user) return <Login onLogin={u=>{setUser(u);showToast(`${u.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`)}}/>;

  const isSA=user.roleLevel==="ìµœê³ ê´€ë¦¬ì";
  const isDM=user.roleLevel==="ë¶€ì„œê´€ë¦¬ì";
  const canAdd=isSA||isDM;

  const nav=[
    {id:"dashboard",l:"ëŒ€ì‹œë³´ë“œ",ic:<Ic.Chart/>},
    {id:"board",l:"ì±„ìš© ë³´ë“œ",ic:<Ic.Board/>},
    ...(isSA?[{id:"applicants",l:"ì „ì²´ ì§€ì›ì",ic:<Ic.Users/>}]:[]),
    {id:"postings",l:"ì±„ìš© ê³µê³ ",ic:<Ic.Briefcase/>},
    ...(isSA?[{id:"accounts",l:"ê³„ì • ê´€ë¦¬",ic:<Ic.Settings/>}]:[]),
  ];
  const titles={dashboard:"ëŒ€ì‹œë³´ë“œ",board:isSA?"ì „ì²´ ì±„ìš© ë³´ë“œ":`${user.department} ì±„ìš© ë³´ë“œ`,applicants:"ì „ì²´ ì§€ì›ì ê´€ë¦¬",postings:"ì±„ìš© ê³µê³  ê´€ë¦¬",accounts:"ê³„ì • ê´€ë¦¬"};
  const roleLabel={"ìµœê³ ê´€ë¦¬ì":"ğŸ‘‘ ìµœê³ ê´€ë¦¬ì","ë¶€ì„œê´€ë¦¬ì":`ğŸ”‘ ${user.department} ê´€ë¦¬ì`,"ì¼ë°˜ì‚¬ìš©ì":`ğŸ‘¤ ${user.department} ì‚¬ìš©ì`};

  return(
    <div className="app-layout">
      <aside className="sidebar">
        <div className="sidebar-brand"><div style={{display:"flex",alignItems:"center",gap:12}}><div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#2563EB,#7C3AED)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:16,color:"#FFF",flexShrink:0}}>B</div><div className="brand-text"><div style={{fontSize:15,fontWeight:700}}>ë°”ë¥¸ ATS</div><div style={{fontSize:11,color:"#94A3B8"}}>ì±„ìš© ê´€ë¦¬ ì‹œìŠ¤í…œ</div></div></div></div>
        <nav className="sidebar-nav">{nav.map(n=><button key={n.id} className={`nav-btn ${page===n.id?"active":""}`} onClick={()=>{setPage(n.id);setSearch("")}}>{n.ic}<span className="nav-label">{n.l}</span></button>)}</nav>
        <div className="sidebar-footer">
          <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:12,padding:"0 6px"}}>
            <div style={{width:32,height:32,borderRadius:8,background:"#334155",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:700,color:"#FFF",flexShrink:0}}>{user.name[0]}</div>
            <div className="user-info"><div style={{fontSize:13,fontWeight:600}}>{user.name}</div><div style={{fontSize:11,color:"#64748B"}}>{roleLabel[user.roleLevel]}</div></div>
          </div>
          <button className="logout-btn" onClick={()=>{setUser(null);setPage("dashboard")}}><Ic.Logout/><span className="logout-label">ë¡œê·¸ì•„ì›ƒ</span></button>
        </div>
      </aside>
      <main className="main-content">
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:28,flexWrap:"wrap",gap:12}}>
          <div>
            <h1 style={{fontSize:22,fontWeight:800}}>{titles[page]}</h1>
            <p style={{fontSize:14,color:"#64748B",marginTop:4}}>
              {isSA?"ì „ì²´ ë¶€ì„œì˜ ì±„ìš© í˜„í™©ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.":`${user.department} ì†Œì† ì§€ì›ìë§Œ ì—´ëŒ ê°€ëŠ¥í•©ë‹ˆë‹¤.`}
              {!isSA&&<span className="privacy-badge" style={{marginLeft:8}}><Ic.Shield/> ê°œì¸ì •ë³´ ë³´í˜¸ ëª¨ë“œ</span>}
            </p>
          </div>
          <div style={{display:"flex",gap:10,alignItems:"center"}}>
            {(page==="board"||page==="applicants")&&<div className="search-wrap"><Ic.Search/><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="ì´ë¦„, ì§ë¬´ ê²€ìƒ‰..."/></div>}
            {canAdd&&(page==="board"||page==="applicants")&&<button className="btn-primary" onClick={()=>setAddM(true)}><Ic.Plus/> ì§€ì›ì ë“±ë¡</button>}
          </div>
        </div>
        {page==="dashboard"&&<Dashboard key={rk} user={user}/>}
        {page==="board"&&<Kanban key={rk} user={user} search={search} onSelect={setSel}/>}
        {page==="applicants"&&isSA&&<AppTable key={rk} user={user} search={search} onSelect={setSel} showToast={showToast}/>}
        {page==="postings"&&<Postings key={rk} user={user} showToast={showToast}/>}
        {page==="accounts"&&isSA&&<AccountMgmt key={rk} user={user} showToast={showToast}/>}
      </main>
      {sel&&<DetailModal appData={sel} user={user} onClose={()=>setSel(null)} onSaved={()=>{refresh();showToast("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")}}/>}
      {addM&&<AddModal user={user} onClose={()=>setAddM(false)} onAdded={()=>{refresh();showToast("ì§€ì›ìê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.")}}/>}
      {toast&&<Toast msg={toast.msg} type={toast.type} onClose={()=>setToast(null)}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
</script>
</body>
</html>
